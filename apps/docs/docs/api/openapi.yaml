openapi: 3.1.0
info:
  title: Abdalkader API
  description: |
    Comprehensive REST API for Abdalkader's portfolio and services.
    
    This API provides endpoints for health monitoring, performance tracking, error reporting, and more.
    
    ## Base URL
    All API requests should be made to:
    - Production: `https://abdalkader.dev/api`
    - Staging: `https://staging.abdalkader.dev/api`
    
    ## Authentication
    Most endpoints require API key authentication. See the [Authentication Guide](/api/authentication) for details.
    
    ## Rate Limiting
    API requests are rate-limited to prevent abuse. See [Rate Limiting](/api/rate-limiting) for details.
    
    ## Support
    For API support, please contact: hello@abdalkader.dev
  version: 1.0.0
  contact:
    name: API Support
    email: hello@abdalkader.dev
    url: https://abdalkader.dev
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: https://abdalkader.dev/api
    description: Production server
  - url: https://staging.abdalkader.dev/api
    description: Staging server
  - url: http://localhost:3000/api
    description: Local development server

tags:
  - name: Health
    description: Health check and system status endpoints
  - name: Performance
    description: Performance monitoring and metrics endpoints
  - name: Errors
    description: Error tracking and reporting endpoints
  - name: Analytics
    description: Analytics and tracking endpoints

paths:
  /health:
    get:
      tags:
        - Health
      summary: Health Check
      description: |
        Returns the health status of the API and system.
        
        This endpoint provides information about:
        - API status (healthy/unhealthy)
        - System uptime
        - Memory usage
        - Environment information
        
        **No authentication required.**
      operationId: getHealth
      responses:
        '200':
          description: System is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
              examples:
                healthy:
                  summary: Healthy system
                  value:
                    status: 'healthy'
                    timestamp: '2024-01-15T10:30:00.000Z'
                    environment: 'production'
                    version: '1.0.0'
                    uptime: 86400
                    checks:
                      memory_usage: 45
        '503':
          description: System is unhealthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
              examples:
                unhealthy:
                  summary: Unhealthy system
                  value:
                    status: 'unhealthy'
                    timestamp: '2024-01-15T10:30:00.000Z'
                    environment: 'production'
                    uptime: 86400
                    checks: {}

  /performance:
    post:
      tags:
        - Performance
      summary: Submit Performance Metric
      description: |
        Submit a performance metric for monitoring and analysis.
        
        **Only available in staging environment.**
        
        This endpoint accepts various performance metrics including:
        - Page load times
        - API response times
        - Resource load times
        - Custom performance metrics
        
        **Authentication required.**
      operationId: submitPerformanceMetric
      security:
        - ApiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PerformanceMetric'
            examples:
              pageLoad:
                summary: Page load time
                value:
                  name: 'page_load_time'
                  value: 1250
                  timestamp: 1705312200000
                  url: 'https://abdalkader.dev'
                  userAgent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64)'
                  page: '/'
                  loadType: 'navigation'
              apiResponse:
                summary: API response time
                value:
                  name: 'api_response_time'
                  value: 150
                  timestamp: 1705312200000
                  url: 'https://abdalkader.dev/api/health'
                  userAgent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64)'
                  endpoint: '/api/health'
                  method: 'GET'
      responses:
        '200':
          description: Metric submitted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PerformanceResponse'
              examples:
                success:
                  summary: Success
                  value:
                    success: true
        '400':
          description: Invalid metric data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalid:
                  summary: Invalid data
                  value:
                    success: false
                    message: 'Invalid metric data'
        '404':
          description: Not available in this environment
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '405':
          description: Method not allowed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /errors:
    post:
      tags:
        - Errors
      summary: Report Error
      description: |
        Report an error for tracking and analysis.
        
        **Only available in staging environment.**
        
        This endpoint accepts error reports including:
        - Error messages
        - Stack traces
        - Context information
        - User session data
        
        **Authentication required.**
      operationId: reportError
      security:
        - ApiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ErrorReport'
            examples:
              clientError:
                summary: Client-side error
                value:
                  message: 'Failed to load resource'
                  stack: 'Error: Failed to load resource\n    at fetchResource (app.js:123:45)'
                  url: 'https://abdalkader.dev'
                  userAgent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64)'
                  timestamp: 1705312200000
                  sessionId: 'sess_abc123'
                  environment: 'production'
                  additionalContext:
                    component: 'ResourceLoader'
                    action: 'fetch'
              runtimeError:
                summary: Runtime error
                value:
                  message: 'TypeError: Cannot read property of undefined'
                  stack: 'TypeError: Cannot read property of undefined\n    at Component.render (component.js:45:12)'
                  url: 'https://abdalkader.dev/projects'
                  userAgent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64)'
                  timestamp: 1705312200000
                  sessionId: 'sess_abc123'
                  environment: 'production'
                  userId: 'user_123'
                  additionalContext:
                    component: 'ProjectList'
                    props: {}
      responses:
        '200':
          description: Error reported successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorReportResponse'
              examples:
                success:
                  summary: Success
                  value:
                    success: true
                    errorId: 'err_1705312200000_abc123xyz'
        '400':
          description: Invalid error report data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Not available in this environment
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '405':
          description: Method not allowed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
      description: |
        API key for authentication. Get your API key from the [API Dashboard](https://abdalkader.dev/api/dashboard).
        
        Example: `X-API-Key: your-api-key-here`
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        JWT token for authentication. Include the token in the Authorization header.
        
        Example: `Authorization: Bearer your-jwt-token-here`

  schemas:
    HealthResponse:
      type: object
      required:
        - status
        - timestamp
        - environment
        - uptime
        - checks
      properties:
        status:
          type: string
          enum: [healthy, unhealthy]
          description: Overall health status of the system
          example: 'healthy'
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 timestamp of the health check
          example: '2024-01-15T10:30:00.000Z'
        environment:
          type: string
          enum: [production, staging, development]
          description: Current environment
          example: 'production'
        version:
          type: string
          description: API version
          example: '1.0.0'
        uptime:
          type: number
          description: System uptime in seconds
          example: 86400
        checks:
          type: object
          description: Detailed health check results
          properties:
            database:
              type: string
              enum: [healthy, unhealthy]
            external_apis:
              type: string
              enum: [healthy, unhealthy]
            memory_usage:
              type: number
              description: Memory usage percentage (0-100)
              minimum: 0
              maximum: 100
              example: 45
            disk_space:
              type: number
              description: Available disk space percentage (0-100)
              minimum: 0
              maximum: 100

    PerformanceMetric:
      type: object
      required:
        - name
        - value
        - timestamp
        - url
        - userAgent
      properties:
        name:
          type: string
          description: Name of the performance metric
          example: 'page_load_time'
        value:
          type: number
          description: Metric value (usually in milliseconds)
          example: 1250
        timestamp:
          type: number
          description: Unix timestamp in milliseconds
          example: 1705312200000
        url:
          type: string
          format: uri
          description: URL where the metric was collected
          example: 'https://abdalkader.dev'
        userAgent:
          type: string
          description: User agent string
          example: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64)'
        page:
          type: string
          description: Page path (for page load metrics)
          example: '/'
        loadType:
          type: string
          enum: [navigation, reload, back_forward, prerender]
          description: Type of page load
        endpoint:
          type: string
          description: API endpoint (for API metrics)
          example: '/api/health'
        method:
          type: string
          enum: [GET, POST, PUT, DELETE, PATCH]
          description: HTTP method (for API metrics)

    PerformanceResponse:
      type: object
      required:
        - success
      properties:
        success:
          type: boolean
          description: Whether the metric was submitted successfully
          example: true
        message:
          type: string
          description: Optional message
          example: 'Metric recorded successfully'

    ErrorReport:
      type: object
      required:
        - message
        - url
        - userAgent
        - timestamp
        - sessionId
        - environment
      properties:
        message:
          type: string
          description: Error message
          example: 'Failed to load resource'
        stack:
          type: string
          description: Error stack trace
          example: 'Error: Failed to load resource\n    at fetchResource (app.js:123:45)'
        url:
          type: string
          format: uri
          description: URL where the error occurred
          example: 'https://abdalkader.dev'
        userAgent:
          type: string
          description: User agent string
          example: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64)'
        timestamp:
          type: number
          description: Unix timestamp in milliseconds
          example: 1705312200000
        userId:
          type: string
          description: Optional user ID
          example: 'user_123'
        sessionId:
          type: string
          description: Session ID
          example: 'sess_abc123'
        buildId:
          type: string
          description: Build ID
          example: 'build_20240115'
        environment:
          type: string
          enum: [production, staging, development]
          description: Environment where error occurred
          example: 'production'
        additionalContext:
          type: object
          description: Additional context about the error
          additionalProperties: true
          example:
            component: 'ResourceLoader'
            action: 'fetch'

    ErrorReportResponse:
      type: object
      required:
        - success
        - errorId
      properties:
        success:
          type: boolean
          description: Whether the error was reported successfully
          example: true
        message:
          type: string
          description: Optional message
        errorId:
          type: string
          description: Unique error ID for tracking
          example: 'err_1705312200000_abc123xyz'

    ErrorResponse:
      type: object
      required:
        - success
      properties:
        success:
          type: boolean
          description: Whether the request was successful
          example: false
        message:
          type: string
          description: Error message
          example: 'Invalid request data'

